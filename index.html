<!DOCTYPE html><html lang="en"><head><title>index</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="index"><meta name="groc-project-path" content="README.md"><meta name="groc-github-url" content="https://github.com/oslugr/ugr-transparente-servidor"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/oslugr/ugr-transparente-servidor/blob/master/README.md">README.md</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="ugr-transparente">UGR Transparente</h1>
<p><em>Version 0.9.11</em><br><a href="https://travis-ci.org/oslugr/ugr-transparente-servidor"><img src="https://travis-ci.org/oslugr/ugr-transparente-servidor.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/github/oslugr/ugr-transparente-servidor?branch=master"><img src="https://coveralls.io/repos/github/oslugr/ugr-transparente-servidor/badge.svg?branch=master" alt="Coverage Status"></a>
<a href="https://gemnasium.com/oslugr/ugr-transparente-servidor"><img src="https://gemnasium.com/oslugr/ugr-transparente-servidor.svg" alt="Dependency Status"></a>
<a href="http://www.gnu.org/licenses/gpl-3.0.en.html"><img src="https://img.shields.io/badge/license-GPL%203.0-blue.svg" alt="License Status"></a>
<a href="https://nodejs.org/en/"><img src="https://img.shields.io/badge/node-4.2.6-blue.svg" alt="Node"></a>
<a href="https://codeclimate.com/github/oslugr/ugr-transparente-servidor"><img src="https://codeclimate.com/github/oslugr/ugr-transparente-servidor/badges/gpa.svg" alt="Code Climate"></a></p>
<hr>
<p>Portal de transparencia de la <a href="http://www.ugr.es/">UGR</a> para publicar los datos y hacerlos accesibles y tratables. Desarrollado con <a href="http://nodejs.org/">Node.js</a> y <a href="http://expressjs.com/">Express</a>.</p>
<p>La aplicación es accesible desde <a href="http://transparente.ugr.es">http://transparente.ugr.es</a>.<br>La documentación se encuentra en <a href="https://oslugr.github.io/ugr-transparente-servidor/">https://oslugr.github.io/ugr-transparente-servidor/</a>.   </p>
<h2 id="instalacin">Instalación</h2>
<ol>
<li><p>En caso de no tener instalado <code>git</code>:   </p>
<pre><code> sudo apt-get install git</code></pre>
</li>
<li><p>Instalamos <strong>Node.js</strong>:</p>
<pre><code> wget -qO- https://deb.nodesource.com/setup_4.x | sudo bash -
 sudo apt-get install -y nodejs</code></pre>
<p> Comprobamos que <strong>Node.js</strong> y <strong>NPM</strong> (su gestor de paquetes) se han instalado correctamente.</p>
<pre><code> node -v
 npm -v</code></pre>
</li>
<li><p>Descargamos todo el contenido del repositorio para poder ejecutar la aplicación.</p>
<pre><code> git clone https://github.com/oslugr/ugr-transparente-servidor.git</code></pre>
</li>
<li><p>Instalamos todas las dependencias de la aplicación:</p>
<pre><code>cd ugr-transparente-servidor
sudo npm install</code></pre>
</li>
<li><p>Finalmente iniciamos la aplicación:</p>
<pre><code> npm start</code></pre>
</li>
<li><p>Igualmente podemos reiniciar o detener la aplicación de una forma similar:</p>
<pre><code> npm restart|stop</code></pre>
</li>
</ol>
<h2 id="provisionamiento">Provisionamiento</h2>
<p>También podemos instalar la aplicación automáticamente aprovisionando el servidor con todo lo necesario mediante <a href="http://www.ansible.com/home">Ansible</a>.</p>
<pre><code>sudo apt-get install ansible</code></pre>
<ol>
<li><p>El archivo <code>ansible_hosts</code> dentro de la carpeta <code>provisioning</code> contiene la dirección del servidor; esta dirección puede ser una dirección IP o una dirección URL.</p>
<pre><code> [transparente]
 transparente.ugr.es</code></pre>
</li>
<li><p>Comprobamos que tenemos conexión SSH con el servidor.</p>
<pre><code> ANSIBLE_HOSTS=provisioning/ansible_hosts ansible transparente -u USUARIO -m ping</code></pre>
<p> Si el acceso es correcto la respuesta del servidor será la siguiente:</p>
<pre><code> transparente.ugr.es | success &gt;&gt; {
     &quot;changed&quot;: false,
     &quot;ping&quot;: &quot;pong&quot;
 }</code></pre>
</li>
<li><p>Para ejecutar el provisionamiento Ansible recibirá como variable de entorno la ruta del <code>ansible_hosts</code> (<code>ANSIBLE_HOSTS=provisioning/ansible_hosts</code>) y como parámetro el usuario con el que accederemos al servidor (<code>--extra-vars &quot;user=USUARIO&quot;</code>). El archivo <code>provisioning/transparente.yml</code> es el <strong>playbook</strong>, el archivo de instrucciones que <strong>Ansible</strong> seguirá para saber que tareas tiene que llevar a cabo durante el provisionamiento.</p>
<pre><code> ANSIBLE_HOSTS=provisioning/ansible_hosts ansible-playbook provisioning/transparente.yml --extra-vars &quot;user=USUARIO&quot;</code></pre>
</li>
</ol>
<h2 id="testing">Testing</h2>
<p>Se incluyen diversos tests unitarios y de integración, así como análisis de covertura usando las herramientas <a href="https://mochajs.org/">mocha</a>, <a href="http://chaijs.com/">chai</a> e <a href="https://github.com/gotwarlost/istanbul">istanbul</a>, ejecuta los tests con el comando:    </p>
<pre><code>npm test</code></pre>
<p>El resultado de los tests unitarios se mostrarán por pantalla como salida de la ejecución, los resultados de los tests de cobertura se mostrarán en <code>coverage/lcov-report/index.html</code>.</p>
<h2 id="documentacin">Documentación</h2>
<p>Para generar automáticamente la documentación con groc ejecutar <code>npm run doc</code>. esta documentación se encontrará en <code>doc/index.html</code>.</p>
<h2 id="integracin-continua">Integración continua</h2>
<p>Disponemos de un sistema de integración continua con <a href="https://travis-ci.org/">Travis CI</a>, que desplegará el sistema y ejecutará los tests con cada cambio del repositorio, el estado actual del sistema se puede observar a continuación:</p>
<ul>
<li><strong>master:</strong> <a href="https://travis-ci.org/oslugr/ugr-transparente-servidor"><img src="https://travis-ci.org/oslugr/ugr-transparente-servidor.svg?branch=master" alt="Build Status"></a></li>
<li><strong>dev:</strong> <a href="https://travis-ci.org/oslugr/ugr-transparente-servidor"><img src="https://travis-ci.org/oslugr/ugr-transparente-servidor.svg?branch=dev" alt="Build Status"></a></li>
</ul>
<p>La integración continua, además, ejecutará diversas herramientas con las que obtenemos información sobre cobertura, dependencias y calidad del código:<br><a href="https://coveralls.io/github/oslugr/ugr-transparente-servidor?branch=master"><img src="https://coveralls.io/repos/github/oslugr/ugr-transparente-servidor/badge.svg?branch=master" alt="Coverage Status"></a>
<a href="https://gemnasium.com/oslugr/ugr-transparente-servidor"><img src="https://gemnasium.com/oslugr/ugr-transparente-servidor.svg" alt="Dependency Status"></a>
<a href="https://codeclimate.com/github/oslugr/ugr-transparente-servidor"><img src="https://codeclimate.com/github/oslugr/ugr-transparente-servidor/badges/gpa.svg" alt="Code Climate"></a></p>
<h2 id="despliegue-automtico">Despliegue automático</h2>
<p>Cuando hagamos cambios en nuestra aplicación y queramos aplicarlos en el servidor, no es necesario que accedamos a él manualmente y apliquemos dichos cambios, podemos usar <a href="https://github.com/pstadler/flightplan">Flightplan</a> para hacer esto automáticamente.</p>
<p>Si queremos utilizar <strong>Flightplan</strong> para el despliegue automático es necesario que tengamos nuestra clave SSH copiada en el servidor como hicimos para el provisionamiento.</p>
<pre><code>ssh-copy-id USUARIO@transparente.ugr.es</code></pre>
<p>El archivo en el que hemos definido la configuración para el despliegue automático es <code>flightplan.js</code>. Podemos diferenciar dos partes esenciales: <code>plan.target</code> y <code>plan.remote</code>; el primero indica los parámetros para acceder al servidor, el segundo indica las tareas a realizar durante el despliegue. Solo falta dar a <strong>Flightplan</strong> la orden de despliegue automático, donde <code>USUARIO</code> es el usuario con permisos de superusuario con el que accederemos al servidor:</p>
<pre><code>USER=USUARIO npm run deploy</code></pre>
<h1 id="estructura-de-la-aplicacin">Estructura de la aplicación</h1>
<h2 id="archivos-en-raz">Archivos en raíz</h2>
<p>La aplicación se encuentra estructurada de forma similar a cualquier proyecto de node.js:</p>
<ul>
<li><code>README.md</code>, <code>LICENSE</code>, <code>.git</code> y <code>.gitignore</code>:  Archivos del repositorio <strong>git</strong></li>
<li><code>.tavis.yml</code>: Archivo de configuración de Travis</li>
<li><code>package.json</code>: Información de la aplicación y dependencias</li>
<li><code>bower.json</code>, <code>getRecursos.sh</code>, <code>flightplan.js</code>: Archivos de despliegue</li>
<li><code>app.js</code>: Archivo principal de la aplicación</li>
<li><code>app/</code>: Archivos del programa<ul>
<li><code>app/routes/</code>: Archivos de enrutamiento de las páginas de la aplicación</li>
</ul>
</li>
<li><code>config/</code>: Archivos de configuración de la aplicación</li>
<li><code>public/</code>: Archivos públicos del portal</li>
<li><code>views/</code>: Vistas de las paginas con <a href="http://jade-lang.com/">Jade</a></li>
<li><code>test/</code>: Archivos de tests unitarios y de integración</li>
<li><code>provisioning/</code>: Archivos de provisionamiento</li>
</ul></div></div></div></div></body></html>